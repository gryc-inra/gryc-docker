version: '3'

services:
    nginx:
        restart: on-failure
        build: ./docker/nginx/prod
        volumes:
            - app_src:/var/www/html

    app:
        restart: on-failure
        environment:
            - SYMFONY_ENV=prod
            - SYMFONY_DEBUG=0
        volumes:
            - app_src:/var/www/html
            - app_data:/var/www/html/files
            - app_session:/var/www/html/var/sessions

    db:
        restart: on-failure

    es1:
        restart: on-failure

    es2:
        restart: on-failure

    rabbitmq:
        restart: on-failure

volumes:
    app_src:
        driver: local
    app_data:
        driver: local
    app_session:
        driver: local
